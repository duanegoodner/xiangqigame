<!-- HTML header for doxygen 1.9.4-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.9.6" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Xiangiqgame: Minimax Details</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
  </script>
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
  </script>
</head>
<body>
  <!-- https://tholman.com/github-corners/ -->
  <a href="https://github.com/duanegoodner/xiangqigame" class="github-corner" aria-label="View source on GitHub"><svg
      width="80" height="80" viewBox="0 0 250 250"
      style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
      <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
      <path
        d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
        fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
      <path
        d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
        fill="currentColor" class="octo-body"></path>
    </svg></a>
  <style>
    .github-corner:hover .octo-arm {
      animation: octocat-wave 560ms ease-in-out
    }
    @keyframes octocat-wave {
      0%,
      100% {
        transform: rotate(0)
      }
      20%,
      60% {
        transform: rotate(-25deg)
      }
      40%,
      80% {
        transform: rotate(10deg)
      }
    }
    @media (max-width:500px) {
      .github-corner:hover .octo-arm {
        animation: none
      }
      .github-corner .octo-arm {
        animation: octocat-wave 560ms ease-in-out
      }
    }
  </style>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectalign">
                <div id="projectname">Xiangiqgame
                </div>
                <div id="projectbrief">AI engine for Xiangqi</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part --><!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_06_minimax_details.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Minimax Details </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The heavy-lifting in our AI engine is handled by the <a class="el" href="classmoveselection_1_1MinimaxMoveEvaluator.html" title="Implements MoveEvaluator interface, and selects move::Move using Minimax algorithm; uses SpaceInfoPro...">moveselection::MinimaxMoveEvaluator</a> class, an implementation of the <a class="el" href="classMoveEvaluator.html" title="CRTP interface with a method for selecting a gameboard::Move (concrete examples = moveselection::Mini...">MoveEvaluator</a> interface. The interface requires implementation of a single method: ImplementMoveSelection which takes a <a class="el" href="structgameboard_1_1MoveCollection.html" title="A container for multiple gameboard::Move objects.">gameboard::MoveCollection</a> of available moves as its only argument, and returns a single <a class="el" href="structgameboard_1_1Move.html" title="A gameboard::BoardSpace pair (start and end).">gameboard::Move</a> selected from the available moves.</p>
<h1><a class="anchor" id="autotoc_md40"></a>
Algorithm Termination Modes</h1>
<p>When <a class="el" href="classmoveselection_1_1MinimaxMoveEvaluator.html#ac3de4f234b69d03a6426bdc4a2bcc2cf">moveselection::MinimaxMoveEvaluator.ImplementSelectMove</a> is called, game state nodes in the game tree are recursively evaluated to a tree depth specified by <a class="el" href="classmoveselection_1_1MinimaxMoveEvaluator.html#a15bea48cb4d01f30ee29e1e609b439c5">moveselection::MinimaxMoveEvaluator.search_depth_</a>. For each visited node, the evaluator determines an integer "points" value, corresponding to how favorable or unfavorable a particular game state is for the evaluating player.</p>
<p>The search down a particular tree branch stops when any of the the following conditions is met:</p>
<ul>
<li>An entry for the node's board state already exists in the evaluator's <a class="el" href="classboardstate_1_1TranspositionTable.html" title="Stores and manages key-value pairs consisting of a board_state (from a boardstate::ZobristComponent) ...">boardstate::TranspositionTable</a></li>
<li>The node is an end game condition leaf (either a win, loss, or draw)</li>
<li>The maximum search depth has been reached</li>
<li>An <a href="https://en.wikipedia.org/wiki/Alpha%E2%80%93beta_pruning">alpha/beta pruning</a> criteria is satisfied</li>
</ul>
<h1><a class="anchor" id="autotoc_md41"></a>
Points Assignment</h1>
<p>Points values of non-leaf nodes, are determined based on the points values of their child nodes. For end-of-game leaf nodes, negative infinity is assigned if the node represents a loss for the evaluator, positive infinity is assigned for a win, and zero is assigned for a draw. When evaluating any other leaf node, we do the following:</p>
<ul>
<li>For each piece on the <a class="el" href="classgameboard_1_1GameBoard.html" title="Implements SpaceInfoProvider interface; stores piece positions, and exposes methods for calculating,...">gameboard::GameBoard</a>, look up the element in the evalutor's 4-D <a class="el" href="structpiecepoints_1_1PiecePositionPoints.html#a1562468626d164564d9631c657266b54">piecepoints::PiecePositionPoints.points_array</a> of integers corresponding to the piece's <a class="el" href="namespacegameboard.html#aae01851261ebf0d4dc64b2157179e142">gameboard::PieceColor</a>, <a class="el" href="namespacegameboard.html#a8d35500d8e8b10edb726f8629fd25e76">gameboard::PieceType</a>, <a class="el" href="structgameboard_1_1BoardSpace.html#a08d5bd02bd1633a17913036f95a81826">gameboard::BoardSpace.rank</a>, and <a class="el" href="structgameboard_1_1BoardSpace.html#ac9af213d1a28426de0e03ec7f98c1dc1">gameboard::BoardSpace.file</a>.</li>
<li>Calculate the the "score" of the game state node as the sum of entries for each piece on the board</li>
</ul>
<p>The entries in <a class="el" href="structpiecepoints_1_1PiecePositionPoints.html#a1562468626d164564d9631c657266b54">piecepoints::PiecePositionPoints.points_array</a> are the same as those used in <a href="http://web.csie.ndhu.edu.tw/sjyen/Papers/2004CCC.pdf">Yen, Shi-Jim, et al. "Computer chinese chess." <em>ICGA journal</em> 27.1 (2004): 3-18.</a></p>
<h1><a class="anchor" id="autotoc_md42"></a>
Pre-Search Sorting of Available Moves</h1>
<p>Prior to evaluating the children of any node, the child nodes are sorted based on the (easy to calculate) non-recursive points associated with each child game state in order from best to worst for the moving player. By iterating over the child nodes in this order for the recursive search, the likelihood of meeting the alpha-beta pruning criteria, and thus being able to skip evaluation of some child nodes, increases significantly.</p>
<h1><a class="anchor" id="autotoc_md43"></a>
Zobrist Coordinator</h1>
<p>An evaluator's <a class="el" href="classboardstate_1_1ZobristCoordinator.html" title="Implements the BoardStateCoordinator interface, providing a moveselection::MinimaxMoveEvaluator with ...">boardstate::ZobristCoordinator</a> coordinates the calculation of <a href="https://en.wikipedia.org/wiki/Zobrist_hashing">Zobrist hash values</a> of each encountered board state, as well as the storage/retrieval of results from each call to <a class="el" href="classmoveselection_1_1MinimaxMoveEvaluator.html#a0accf376c40fca7eb2d70b9d14660538">moveselection::MinimaxMoveEvaluator.MinimaxRecursive</a> in a <a class="el" href="classboardstate_1_1TranspositionTable.html" title="Stores and manages key-value pairs consisting of a board_state (from a boardstate::ZobristComponent) ...">boardstate::TranspositionTable</a>.</p>
<p>The coordinator's <a class="el" href="classboardstate_1_1ZobristCoordinator.html#a7c5f1d0a5ba9307896f2719af1ed924b">boardstate::ZobristCoordinator.zobrist_component_</a> contains one or more <a class="el" href="classboardstate_1_1ZobristCalculator.html" title="Uses Zobrist hashing to calculate a &quot;reasonably unique&quot; integer value for each board configuration en...">boardstate::ZobristCalculator</a> objects. The <a class="el" href="classboardstate_1_1ZobristComponent.html#af69fc3f967d6e844cc36ffac5e2bca87">boardstate::ZobristComponent.primary_calculator_</a> is used to calculate the Zobrist hash values that are used as keys in <a class="el" href="classboardstate_1_1TranspositionTable.html#a47b6057e1e4a732d19d642493a250a6a">boardstate::TranspositionTable.data_</a> (a std::unordered_map). Each value in a <a class="el" href="classboardstate_1_1TranspositionTable.html#a47b6057e1e4a732d19d642493a250a6a">boardstate::TranspositionTable.data_</a> entry is the result of a call to <a class="el" href="classmoveselection_1_1MinimaxMoveEvaluator.html#a0accf376c40fca7eb2d70b9d14660538">moveselection::MinimaxMoveEvaluator.MinimaxRecursive</a>.</p>
<p>The moveselection::ZobristCoordinator.confirmation_keys_ attribute is a std::array that can hold zero or more <a class="el" href="classboardstate_1_1ZobristCalculator.html" title="Uses Zobrist hashing to calculate a &quot;reasonably unique&quot; integer value for each board configuration en...">boardstate::ZobristCalculator</a> objects. If this array is non-empty, the <a class="el" href="classboardstate_1_1ZobristCalculator.html" title="Uses Zobrist hashing to calculate a &quot;reasonably unique&quot; integer value for each board configuration en...">boardstate::ZobristCalculator</a> objects in it are used to calculate "backup" hash values which are included in the <a class="el" href="classboardstate_1_1TranspositionTableEntry.html" title="Data structure to hold calculation results that get entered into a boardstate::TranspositionTable.">boardstate::TranspositionTableEntry</a> values of <a class="el" href="classboardstate_1_1TranspositionTable.html#a47b6057e1e4a732d19d642493a250a6a">boardstate::TranspositionTable.data_</a> and are then used to detect hash collisions in the <a class="el" href="classboardstate_1_1TranspositionTable.html" title="Stores and manages key-value pairs consisting of a board_state (from a boardstate::ZobristComponent) ...">boardstate::TranspositionTable</a>. For sufficiently large hash key sizes, using one or more <a class="el" href="classboardstate_1_1ZobristCalculator.html" title="Uses Zobrist hashing to calculate a &quot;reasonably unique&quot; integer value for each board configuration en...">boardstate::ZobristCalculator</a> in moveselection::ZobristCoordinator.confirmation_keys_ can reliably detect the existence of any hash collision.</p>
<p>With two or more elements in moveselection::ZobristCoordinator.confirmation_keys_, it would be possible to correct (i.e. avoid any confounding due to) a collision. Currently, our AI engine contains methods for detecting collisions when we have one or more backup calculators, but does not implement any method for "correcting" misinformation caused by a collision.</p>
<h1><a class="anchor" id="autotoc_md44"></a>
Performance</h1>
<p>Using an Intel i7-13700K CPU, the average evaluation time per node of <a class="el" href="classmoveselection_1_1MinimaxMoveEvaluator.html" title="Implements MoveEvaluator interface, and selects move::Move using Minimax algorithm; uses SpaceInfoPro...">moveselection::MinimaxMoveEvaluator</a> is ~15 ns. With an evaluator's search depth set to 7, the maximum number of nodes visited for any single move selection during the course of a game is ~ 2e7 nodes. With a shallower search depth of just three layers in the game tree, this value drops to ~5e3 nodes.</p>
<h1><a class="anchor" id="autotoc_md45"></a>
Possible Improvements</h1>
<h2><a class="anchor" id="autotoc_md46"></a>
A Smarter Evaluator</h2>
<p>Our heuristic-based approach to node evaluation with constant maximum search depth throughout the game is fairly simple and can almost certainly be improved. Potential paths for improvement include the use of iterative deepening, quiescent searches, Monte Carlo tree searches, and deep learning based implementations of the PiecePoints and/or <a class="el" href="classMoveEvaluator.html" title="CRTP interface with a method for selecting a gameboard::Move (concrete examples = moveselection::Mini...">MoveEvaluator</a> interfaces. In many cases, implementing extensions/improvements could be relatively straightforward due to the plug-in architecture of our AI engine.</p>
<h2><a class="anchor" id="autotoc_md47"></a>
Speed Improvements</h2>
<p>By using C++ (instead of a higher level language) for the core engine, and taking some care in design decisions (e.g. compile time polymorphism for interfaces), we have achieved decent performance in Xiangqigame, but there is certainly room for improvement. <a class="el" href="classmoveselection_1_1MinimaxMoveEvaluator.html" title="Implements MoveEvaluator interface, and selects move::Move using Minimax algorithm; uses SpaceInfoPro...">moveselection::MinimaxMoveEvaluator</a>, along with most other parts of the AI engine has not been extensively profiled. Running performance profiling would likely reveal bottlenecks that can be improved.</p>
<p>Currently, the recursive Minimax algorithm runs on a single thread. Incorporating some parallelism into the engine with a tool such as <a href="https://www.openmp.org/wp-content/uploads/OpenMP-UMT-Tasking-1.pdf">OpenMP tasks</a> would provide another path for speed improvements.</p>
<h2><a class="anchor" id="autotoc_md48"></a>
Reduce Python Responsibilities</h2>
<div class="section_buttons"></div><div class="section_buttons"><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Previous   </th><th class="markdownTableHeadRight">Next    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="md_docs_05_components.html">Components</a>   </td><td class="markdownTableBodyRight"><a class="el" href="md_docs_07_game_data.html">Engine Data</a>   </td></tr>
</table>
</div><div class="section_buttons"></div> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Dec 12 2024 22:20:57 for Xiangiqgame by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
